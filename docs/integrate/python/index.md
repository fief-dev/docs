---
description: Add Fief authentication to your Python projects in a few minutes.
---

# Python

We provide an official client for Python. You can install it with `pip`:

```bash
pip install fief-client
```

## Create a `Fief` client

!!! abstract "Prerequisites"
    - [x] Allow the following [Redirect URI](../../getting-started/clients.md#redirect-uris) on your Fief Client: `http://localhost:8000/callback`

The Fief client provides all the necessary methods to manage OAuth2 authentication, validate access tokens and refresh them.

```py title="client.py" hl_lines="3-7"
--8<-- "examples/python/client.py"
```

1. **Base URL of your Fief tenant**

    You can find it in the admin dashboard, in the **Tenants** list. [More info](../../getting-started/tenants.md#base-url)

    ![Find base URL in admin dashboard](/assets/images/admin-tenants.png)

2. **ID of your Fief client**

    You can find it in the admin dashboard, in the **Clients** list. [More info](../../getting-started/clients.md)

    ![Find Client ID in admin dashboard](/assets/images/admin-clients-detail.png)

    !!! info
        A first client is always created for you when you create your workspace. When getting started, you should use this one.

3. **Secret of your Fief client**

    You can find it in the admin dashboard, in the **Clients** list. [More info](../../getting-started/clients.md)

    ![Find Client Secret in admin dashboard](/assets/images/admin-clients-detail.png)

    !!! info
        A first client is always created for you when you create your workspace. When getting started, you should use this one.

--8<-- "reusables/hardcoded-secrets-callout.md"

!!! info "Async support"
    For `asyncio` enthusiasts, we also provide a `FiefAsync` class with the same methods.

## Perform an OAuth2 flow manually

The simple script below shows you how to authenticate with OAuth2 "manually". The goal is to show you how to use the client. You'll then be able to integrate it in your own project with your framework and stack.

The first step is to generate an **authorization URL**, which is an URL on the Fief server that'll ask you for your email address and password.

```py title="client.py" hl_lines="9-12"
--8<-- "examples/python/client.py"
```

Then, we make the script prompt for the **authorization code**.

```py title="client.py" hl_lines="14"
--8<-- "examples/python/client.py"
```

This temporary code is generated by Fief upon successful login and can be used to obtain valid tokens. Fief returns both an **access token** and an **ID token**, which contains information about the user.

```py title="client.py" hl_lines="16-18"
--8<-- "examples/python/client.py"
```

### Test it

You can run this script from a command line:

```bash
python client.py
```

You'll get the following output:

```
Open this URL in your browser: https://example.fief.dev/authorize?response_type=code&client_id=YOUR_CLIENT_ID&redirect_uri=http%3A%2F%2Flocalhost%3A8000%2Fcallback&scope=openid
Paste the callback code:
```

You can **copy and paste this URL manually in your browser**. You'll be redirected to a Fief login page.

![Fief login page](/assets/images/fief-login.png)

Upon successful login, Fief will redirect to the redirect URL you defined above, including a query parameter named `code`. It'll look like this:

```
http://localhost:8000/redirect?code=wPEDiSRkoYOtA-4QCJHpsLne0P2PXVYAlW6hcH5OVBg
```

!!! tip "Your browser will probably show an error at this point"
    In this simple implementation, we don't have a web server running on our local machine, so the browser won't be able to open the redirect URL. It's not a problem: what we care about is retrieving the authorization code by hand.

Copy the code value, get back to the command line where the script is running and paste it. You'll get the following output:

```
Paste the callback code: wPEDiSRkoYOtA-4QCJHpsLne0P2PXVYAlW6hcH5OVBg
Tokens: {'access_token': 'eyJhbGciOiJSUzI1NiJ9.eyJhdWQiOlsiRE9JaGpfNzJIYTlyWWg5dURnbmRTdTYyRVhKdUZmUTVsa2t4MS1rc1VJbyJdLCJhenAiOiJET0loal83MkhhOXJZaDl1RGduZFN1NjJFWEp1RmZRNWxra3gxLWtzVUlvIiwiZXhwIjoxNjQ4MDUwNDIzLCJpYXQiOjE2NDgwNDY4MjMsImlzcyI6Imh0dHBzOi8vZXhhbXBsZS5maWVmLmRldiIsInNjb3BlIjoib3BlbmlkIiwic3ViIjoiYTM4NDZjYzEtN2MwOC00Mzg5LThjOGUtYzBlNzlmNzA3NWZlIn0.R5JnZW9Vq6lWai-FZcqsihYxmtFRbIjZ7D0Ck9XAG0d2YnQQ7ms3bUwtXEAnLhos4C3paGDa0PzQRtXSAx4IH85ZdeVJoBk9GrOj1ZV7E6dtZZSZlvtY2msMeXFC9gNg-A86R9ZU_T0PoROof0u1eJHYVlmo_dv2fodyNqkDB8V6HK3vqf7jaqNQtk8Fg6eHKhwb-3bAtjb5cpWAAWhMSrHZzTWIYUvYsvwAas5ihgenv3UOkpcl_p7b7G9SDhGE5abPQQ7lvyfhYZE7CV1DzVRU6UL4N0D2l4uI3RJNOQoECvltfo2etYzp5viwAwvg9LUS3466Ra1i8beBKXsPFQ', 'id_token': 'eyJhbGciOiJSUzI1NiJ9.eyJhdWQiOlsiRE9JaGpfNzJIYTlyWWg5dURnbmRTdTYyRVhKdUZmUTVsa2t4MS1rc1VJbyJdLCJhenAiOiJET0loal83MkhhOXJZaDl1RGduZFN1NjJFWEp1RmZRNWxra3gxLWtzVUlvIiwiZW1haWwiOiJmcmFuY29pcyt0ZXN0QGZpZWYuZGV2IiwiZXhwIjoxNjQ4MDUwNDIzLCJpYXQiOjE2NDgwNDY4MjMsImlzcyI6Imh0dHBzOi8vZXhhbXBsZS5maWVmLmRldiIsInN1YiI6ImEzODQ2Y2MxLTdjMDgtNDM4OS04YzhlLWMwZTc5ZjcwNzVmZSIsInRlbmFudF9pZCI6IjcwNDEzNWI2LTRiZmQtNGM1NS04MDkwLWM2MzhhNmJhNTNhMiJ9.ULQy7TlgF5_oQwwgA6ydTahTYE31obr4F3olJy-mgyPw67XstoJLM1VwUNawzyz2Iu2QDmgcBrH3OMVfgCkBAFk2sp-QQIDr9arIF1QXNKG65El3zgPQ5-niTTsIuAkemyjNGcpdrcN2b9FaeodzauO5eOjno60h5dTBbcLnqv00V-Jv6sq8lB8_o5JXHKWUoZZA2VFEDox9MXfhDqrvyHcitsIRWIy7XhILKcZ-JG_AMcXnuDcyMnsoy91-gJznvMk7_ty9eNWs8Cm0ZhK3nMqEKML4tXIREmIN-vYUGDtbDWX3O45N98ovu9gJi9S3aVOh-gZQsnwauJmlW82ZQQ', 'token_type': 'bearer', 'expires_in': 3600}
Userinfo: {'aud': ['YOUR_CLIENT_ID'], 'azp': 'YOUR_CLIENT_ID', 'email': 'anne@bretagne.duchy', 'exp': 1648050423, 'iat': 1648046823, 'iss': 'https://example.fief.dev', 'sub': 'a3846cc1-7c08-4389-8c8e-c0e79f7075fe', 'tenant_id': '704135b6-4bfd-4c55-8090-c638a6ba53a2'}
```

As you can see, we obtained a first dictionary `tokens` containing an access token, an ID token and other standard OAuth2 information.

The second variable, `userinfo`, is a dictionary with the user data. It's actually the information contained in the ID token that the client decoded for you.

## What's next?

You have the fundamental basics for performing an OAuth2 authentication with the Fief Python client.

To help you further, we provide you helpers and examples for popular Python frameworks like Flask or FastAPI.

[Integrate with FastAPI](fastapi.md){ .md-button }
[Integrate with Flask](flask.md){ .md-button }
{: .buttons }

## Reference

### `Fief` client

!!! abstract "Initializer"
    * `base_url: str`: Base URL of your Fief tenant.
    * `client_id: str`: ID of your Fief client.
    * `client_secret: str`: Secret of your Fief client.
    * `encryption_key: Optional[str] = None`: Encryption key of your Fief client. Necessary only if [ID Token encryption](../../going-further/id-token-encryption.md) is enabled.

#### `auth_url`

Returns an authorization URL.

!!! abstract "Parameters"
    * `redirect_uri: str`: Your callback URI where the user will be redirected after Fief authentication.
    * `state: str = None`: Optional string that will be returned back in the callback parameters to allow you to retrieve state information.
    * `scope: Optional[List[str]] = None`: Optional list of scopes to ask for.
    * `code_challenge: Optional[str] = None`: Optional code challenge for [PKCE process](../../going-further/pkce.md).
    * `code_challenge_method: Optional[str] = None`: Method used to hash the PKCE code challenge.
    * `extras_params: Optional[Dict[str, Any]] = None`: Optional dictionary containing specific parameters.

!!! example
    ```py
    auth_url = fief.auth_url("http://localhost:8000/callback", scope=["openid"])
    ```

#### `auth_callback`

Returns a [`FiefTokenResponse`](#fieftokenresponse) and [`FiefUserInfo`](#fiefuserinfo) in exchange of an authorization code.

!!! abstract "Parameters"
    * `code: str`: The authorization code.
    * `redirect_uri: str`: The exact same `redirect_uri` you passed to the authorization URL.
    * `code_verifier: Optional[str] = None`: The raw [PCKE](../../going-further/pkce.md) code used to generate the code challenge during authorization.

!!! example
    ```py
    tokens, userinfo = fief.auth_callback("CODE", "http://localhost:8000/callback")
    ```

#### `auth_refresh_token`

Returns fresh [`FiefTokenResponse`](#fieftokenresponse) and [`FiefUserInfo`](#fiefuserinfo) in exchange of a refresh token.

!!! abstract "Parameters"
    * `refresh_token: str`: A valid refresh token.
    * `scope: Optional[List[str]] = None`: Optional list of scopes to ask for. If not provided, the access token will share the same list of scopes as requested the first time. Otherwise, it should be a subset of the original list of scopes.

!!! example
    ```py
    tokens, userinfo = fief.auth_refresh_token("REFRESH_TOKEN")
    ```

#### `validate_access_token`

Checks if an access token is valid and optionally that it has a required list of scopes, or a required list of [permissions](../../getting-started/access-control.md). Returns a [`FiefAccessTokenInfo`](#fiefaccesstokeninfo).

!!! abstract "Parameters"
    * `access_token: str`: The access token to validate.
    * `required_scope: Optional[List[str]] = None`: Optional list of scopes to check for.
    * `required_permissions: Optional[List[str]] = None`: Optional list of permissions to check for.

!!! example "Example: Validate access token with required scopes"
    ```py
    from fief_client import FiefAccessTokenInvalid, FiefAccessTokenExpired, FiefAccessTokenMissingScope

    try:
        access_token_info = fief.validate_access_token("ACCESS_TOKEN", required_scope=["required_scope"])
    except FiefAccessTokenInvalid:
        print("Invalid access token")
    except FiefAccessTokenExpired:
        print("Expired access token")
    except FiefAccessTokenMissingScope:
        print("Missing required scope")

    print(access_token_info)
    ```

!!! example "Example: Validate access token with required permissions"
    ```py
    from fief_client import FiefAccessTokenInvalid, FiefAccessTokenExpired, FiefAccessTokenMissingPermission

    try:
        access_token_info = fief.validate_access_token("ACCESS_TOKEN", required_permissions=["castles:create", "castles:read"])
    except FiefAccessTokenInvalid:
        print("Invalid access token")
    except FiefAccessTokenExpired:
        print("Expired access token")
    except FiefAccessTokenMissingPermission:
        print("Missing required permission")

    print(access_token_info)
    ```

#### `userinfo`

Returns fresh [`FiefUserInfo`](#fiefuserinfo) from the Fief API using a valid access token.

!!! abstract "Parameters"
    * `access_token: str`: A valid access token

!!! example
    ```py
    userinfo = fief.userinfo("ACCESS_TOKEN")
    ```

#### `update_profile`

Updates user information with the Fief API using a valid access token.

!!! abstract "Parameters"
    * `access_token: str`: A valid access token
    * `data: Dict[str, Any]`: A dictionary containing the data to update

!!! example "Update email address"
    ```py
    userinfo = fief.update_profile("ACCESS_TOKEN", { "email": "anne@nantes.city" })
    ```

!!! example "Update password"
    ```py
    userinfo = fief.update_profile("ACCESS_TOKEN", { "password": "hermine1" })
    ```

!!! example "Update user field"
    To update [user field](../../getting-started/user-fields.md) values, you need to nest them into a `fields` dictionary, indexed by their slug.

    ```py
    userinfo = fief.update_profile("ACCESS_TOKEN", { "fields": { "first_name": "Anne" } })
    ```

#### `logout_url`

Returns a logout URL. If you redirect the user to this page, Fief will clear the session stored on its side.

**You're still responsible for clearing your own session mechanism if any.**

!!! abstract "Parameters"
    * `redirect_uri: str`: A valid URL where the user will be redirected after the logout process

!!! example
    ```py
    logout_url = fief.logout_url("http://localhost:8000")
    ```

### `FiefTokenResponse`

Typed dictionary containing the tokens and related information returned by Fief after a successful authentication.

!!! abstract "Structure"
    * `access_token: str`: Access token you can use to call the Fief API
    * `id_token: str`: ID token containing user information
    * `token_type: str`: Type of token, usually `bearer`
    * `expires_int: int`: Number of seconds after which the tokens will expire
    * `refresh_token: Optional[str]`: Token provided only if scope `offline_access` was granted. Allows you to retrieve fresh tokens using the [`auth_refresh_token`](#auth_refresh_token) method.


### `FiefAccessTokenInfo`

Typed dictionary containing information about the access token.

!!! abstract "Structure"
    * `id: uuid.UUID`: ID of the user
    * `scope: List[str]`: List of granted scopes for this access token
    * `permissions: List[str]`: List of [granted permissions](../../getting-started/access-control.md) for this user
    * `access_token: str`: Access token you can use to call the Fief API


!!! example
    ```py
    {
        "id": "aeeb8bfa-e8f4-4724-9427-c3d5af66190e",
        "scope": ["openid", "required_scope"],
        "permissions": ["castles:read", "castles:create", "castles:update", "castles:delete"],
        "access_token": "ACCESS_TOKEN",
    }
    ```

### `FiefUserInfo`

Dictionary containing user information.

!!! abstract "Structure"
    * `sub: str`: ID of the user
    * `email: str`: Email address of the user
    * `tenant_id: str`: ID of the [tenant](../../getting-started/tenants.md) associated to the user
    * Available [user fields](../../getting-started/user-fields.md) values for this user, indexed by their slug.

!!! example
    ```py
    {
        "sub": "aeeb8bfa-e8f4-4724-9427-c3d5af66190e",
        "email": "anne@bretagne.duchy",
        "tenant_id": "c91ecb7f-359c-4244-8385-51ecd6c0d06b",
        "first_name": "Anne",
        "last_name": "De Bretagne",
    }
    ```

### `pkce` module

This module offers utility function to help with [PKCE process](../../going-further/pkce.md).

#### `get_code_verifier`

Generate a code verifier suitable for PKCE.

!!! example
    ```py
    from fief_client import pkce

    code_verifier = pkce.get_code_verifier()
    ```

#### `get_code_challenge`

Generate the PKCE code challenge for the given code and method.

!!! abstract "Parameters"
    * `code: str`: The code to generate the challenge for. See [`get_code_verifier`](#get_code_verifier)
    * `method: Literal["plain", "S256"] = "S256"`: Method used to hash the PKCE code challenge. The default, `S256`, is the recommended and secure method.

!!! example
    ```py
    from fief_client import pkce

    code_verifier = pkce.get_code_verifier()
    code_challenge = pkce.get_code_challenge(code_verifier)
    ```
